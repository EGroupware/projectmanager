{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./sources/ext/undo.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","gantt","config","undo_steps","undo","redo","this","_undo","getUndoStack","_undoStack","getRedoStack","_redoStack","clearUndoStack","clearRedoStack","undo_types","link","task","undo_actions","update","remove","add","move","maxSteps","undo_enabled","redo_enabled","_push","stack","action","commands","length","event","callEvent","push","shift","_pop","pop","_reorderCommands","weights","any","actionWeights","sort","b","entity","type","oldValue","parent","$index","weightA","updateConfigs","_applyAction","invert","copy","command","entities","actions","methods","isExists","batchUpdate","method","check","id","logAction","slice","revert","inverseCommands","load","clear","assert","monitor","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","isMoveEventsIgnored","toggleIgnoreMoveEvents","newValue","startIgnore","stopIgnore","startBatchAction","timeout","clearTimeout","setTimeout","stopBatchAction","_storeCommand","_storeEntityCommand","obj","old","actionType","entityType","_storeTaskCommand","getInitialTask","_storeLinkCommand","getInitialLink","onTaskAdded","onTaskUpdated","onTaskMoved","onTaskDeleted","_nestedTasks","children","_nestedLinks","childrenLinks","onLinkAdded","onLinkUpdated","onLinkDeleted","_initialTasks","_getLinks","$source","concat","$target","setNestedTasks","taskIds","tasks","linkIds","getTask","setInitialTask","uniqueLinks","links","setInitialLink","overwrite","getTaskIndex","setInitialTaskObject","clearInitialTasks","_initialLinks","getLink","noTrack","onBeforeUndo","onBeforeRedo","attachEvent","batchActions","store","eachTask","child","deleteCacheCooldown","saveInitialAll","nested","ext","inlineEditors","state","datastore","getDatastore","getMoveObjectByTaskId","updTask","oldId","newId","changeTaskCommandId","updLink","oldTaskId","newTaskId","source","target","changeLinkCommandId","updateTasksIds","log","entry","j","updateLinksIds","tindex","e"],"mappings":"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","file":"ext/dhtmlxgantt_undo.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/codebase/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 211);\n","gantt.config.undo_steps = 10;\r\ngantt.config.undo = true;\r\ngantt.config.redo = true;\r\n\r\ngantt.undo = function(){\r\n\tthis._undo.undo();\r\n};\r\n\r\ngantt.getUndoStack = function(){\r\n\treturn this._undo._undoStack;\r\n};\r\n\r\ngantt.getRedoStack = function(){\r\n\treturn this._undo._redoStack;\r\n};\r\n\r\ngantt.clearUndoStack = function(){\r\n\tthis._undo._undoStack = [];\r\n};\r\n\r\ngantt.clearRedoStack = function(){\r\n\tthis._undo._redoStack = [];\r\n};\r\n\r\ngantt.redo = function(){\r\n\tthis._undo.redo();\r\n};\r\n\r\n/**\r\n * entities that require different processing for undoing-redoing changes\r\n * @type {{link: string, task: string}}\r\n */\r\ngantt.config.undo_types = {\r\n\tlink: \"link\",\r\n\ttask: \"task\"\r\n};\r\n\r\n/**\r\n * types of traced actions\r\n * @type {{update: string, remove: string, add: string}}\r\n */\r\ngantt.config.undo_actions = {\r\n\tupdate: \"update\",\r\n\tremove: \"remove\", // remove item from datastore\r\n\tadd: \"add\",\r\n\tmove: \"move\" // move task in grid\r\n};\r\n\r\ngantt._undo = {\r\n\t_undoStack:[],\r\n\t_redoStack:[],\r\n\tmaxSteps:10,\r\n\tundo_enabled: true,\r\n\tredo_enabled: true,\r\n\t_push: function(stack, action){\r\n\t\tif(!action.commands.length)\r\n\t\t\treturn;\r\n\r\n\t\tvar event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\r\n\t\tif(gantt.callEvent(event, [action]) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// commands can be removed from event handler\r\n\t\tif(!action.commands.length)\r\n\t\t\treturn;\r\n\r\n\t\tstack.push(action);\r\n\t\twhile(stack.length > this.maxSteps){\r\n\t\t\tstack.shift();\r\n\t\t}\r\n\t\treturn action;\r\n\t},\r\n\t_pop:function(stack){\r\n\t\treturn stack.pop();\r\n\t},\r\n\r\n\t_reorderCommands: function(action){\r\n\t\t// firstly process tasks and only then links\r\n\t\t// in order to ensure links are added not earlier than their tasks\r\n\t\t// firstly to 'move' actions and only then updates\r\n\t\tvar weights = {any: 0, link:1, task:2};\r\n\t\tvar actionWeights = {move: 1, any:0};\r\n\t\taction.commands.sort(function(a, b){\r\n\t\t\tif(a.entity == \"task\" && b.entity == \"task\"){\r\n\t\t\t\tif(a.type != b.type){\r\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\r\n\t\t\t\t}else if(a.type == \"move\" && a.oldValue && b.oldValue && b.oldValue.parent == a.oldValue.parent) {\r\n\t\t\t\t\treturn a.$index - b.$index;\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t}else{\r\n\t\t\t\tvar weightA = weights[a.entity] || weights.any;\r\n\t\t\t\tvar weightB = weights[b.entity] || weights.any;\r\n\t\t\t\treturn weightB - weightA;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t},\r\n\tundo:function(){\r\n\t\tthis.updateConfigs();\r\n\t\tif(!this.undo_enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar action = this._pop(this._undoStack);\r\n\t\tif(action)\r\n\t\t\tthis._reorderCommands(action);\r\n\t\tif(gantt.callEvent(\"onBeforeUndo\", [action]) !== false){\r\n\t\t\tif(action){\r\n\r\n\t\t\t\tthis._applyAction(this.action.invert(action));\r\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\r\n\t},\r\n\r\n\tredo:function(){\r\n\t\tthis.updateConfigs();\r\n\t\tif(!this.redo_enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar action = this._pop(this._redoStack);\r\n\t\tif(action)\r\n\t\t\tthis._reorderCommands(action);\r\n\r\n\t\tif(gantt.callEvent(\"onBeforeRedo\", [action]) !== false){\r\n\t\t\tif(action){\r\n\t\t\t\tthis._applyAction(action);\r\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\r\n\t},\r\n\r\n\t_applyAction:function(action){\r\n\t\tvar command = null,\r\n\t\t\tentities = this.command.entity,\r\n\t\t\tactions = this.command.type;\r\n\r\n\t\tvar methods = {};\r\n\t\tmethods[entities.task] = {\r\n\t\t\tadd: \"addTask\",\r\n\t\t\tupdate: \"updateTask\",\r\n\t\t\tremove: \"deleteTask\",\r\n\t\t\tmove: \"moveTask\",\r\n\t\t\tisExists: \"isTaskExists\"\r\n\t\t};\r\n\t\tmethods[entities.link] = {\r\n\t\t\tadd: \"addLink\",\r\n\t\t\tupdate: \"updateLink\",\r\n\t\t\tremove: \"deleteLink\",\r\n\t\t\tisExists: \"isLinkExists\"\r\n\t\t};\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\tfor (var i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tcommand = action.commands[i];\r\n\t\t\t\tvar method = methods[command.entity][command.type],\r\n\t\t\t\t\tcheck = methods[command.entity][\"isExists\"];\r\n\r\n\t\t\t\tif (command.type == actions.add) {\r\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$index);\r\n\t\t\t\t} else if (command.type == actions.remove) {\r\n\t\t\t\t\tif (gantt[check](command.value.id))\r\n\t\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t} else if (command.type == actions.update) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value);\r\n\t\t\t\t} else if (command.type == actions.move) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value.$index, command.value.parent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t//storeUndo:\r\n\tlogAction: function(action){\r\n\t\tthis._push(this._undoStack, action);\r\n\t\tthis._redoStack = [];\r\n\t},\r\n\r\n\taction: {\r\n\t\tcreate: function(commands){\r\n\t\t\treturn {commands: commands ? commands.slice() : []};\r\n\t\t},\r\n\t\tinvert: function(action){\r\n\t\t\tvar revert = gantt.copy(action);\r\n\t\t\tvar commands = gantt._undo.command;\r\n\r\n\t\t\tfor(var i = 0; i < action.commands.length; i++){\r\n\t\t\t\tvar command = revert.commands[i] = commands.invert(revert.commands[i]);\r\n\t\t\t\tif(command.type == commands.type.update || command.type == commands.type.move){\r\n\t\t\t\t\tvar value = command.value;\r\n\t\t\t\t\tcommand.value = command.oldValue;\r\n\t\t\t\t\tcommand.oldValue = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn revert;\r\n\t\t}\r\n\t},\r\n\r\n\tcommand:{\r\n\t\tcreate: function(value, oldValue, type, entity){\r\n\t\t\treturn {\r\n\t\t\t\tentity:entity,\r\n\t\t\t\ttype:type,\r\n\t\t\t\tvalue:gantt.copy(value),\r\n\t\t\t\toldValue:gantt.copy(oldValue || value)\r\n\t\t\t};\r\n\t\t},\r\n\t\tinvert: function(command){\r\n\t\t\tvar revert = gantt.copy(command);\r\n\t\t\trevert.type = this.inverseCommands(command.type);\r\n\t\t\treturn revert;\r\n\t\t},\r\n\t\t// entities that require different processing for undoing-redoing changes\r\n\t\tentity:null,\r\n\r\n\t\t//types of traced actions\r\n\t\ttype:null,\r\n\t\tinverseCommands:function(command){\r\n\t\t\tswitch (command){\r\n\t\t\t\tcase this.type.update:\r\n\t\t\t\t\treturn this.type.update;\r\n\t\t\t\tcase this.type.remove:\r\n\t\t\t\t\treturn this.type.add;\r\n\t\t\t\tcase this.type.add:\r\n\t\t\t\t\treturn this.type.remove;\r\n\t\t\t\tcase this.type.load:\r\n\t\t\t\t\treturn this.type.clear;\r\n\t\t\t\tcase this.type.clear:\r\n\t\t\t\t\treturn this.type.load;\r\n\t\t\t\tcase this.type.move:\r\n\t\t\t\t\treturn this.type.move;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tmonitor: {\r\n\t\t_batchAction: null,\r\n\t\t_batchMode: false,\r\n\t\t_ignore: false,\r\n\t\t_ignoreMoveEvents: false,\r\n\t\tisMoveEventsIgnored: function() {\r\n\t\t\treturn this._ignoreMoveEvents;\r\n\t\t},\r\n\t\ttoggleIgnoreMoveEvents: function(newValue) {\r\n\t\t\tthis._ignoreMoveEvents = newValue || false;\r\n\t\t},\r\n\t\tstartIgnore: function(){\r\n\t\t\tthis._ignore = true;\r\n\t\t},\r\n\t\tstopIgnore: function(){\r\n\t\t\tthis._ignore = false;\r\n\t\t},\r\n\t\tstartBatchAction : function(){\r\n\t\t\t// try catching updates made from event handlers using timeout\r\n\t\t\tif(this.timeout){\r\n\t\t\t\tclearTimeout(this.timeout);\r\n\t\t\t}\r\n\t\t\tthis.timeout = setTimeout(function(){\r\n\t\t\t\tgantt._undo.monitor.stopBatchAction();\r\n\t\t\t}, 10);\r\n\r\n\r\n\t\t\tif(this._ignore || this._batchMode)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis._batchMode = true;\r\n\t\t\tthis._batchAction = gantt._undo.action.create();\r\n\t\t},\r\n\t\tstopBatchAction: function(){\r\n\t\t\tif(this._ignore)\r\n\t\t\t\treturn;\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tif(this._batchAction){\r\n\t\t\t\tundo.logAction(this._batchAction);\r\n\t\t\t}\r\n\t\t\tthis._batchMode = false;\r\n\t\t\tthis._batchAction = null;\r\n\t\t},\r\n\r\n\t\t_storeCommand: function(command){\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tundo.updateConfigs();\r\n\r\n\t\t\tif(!undo.undo_enabled)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(this._batchMode){\r\n\t\t\t\tthis._batchAction.commands.push(command);\r\n\t\t\t}else{\r\n\t\t\t\tvar action = undo.action.create([command]);\r\n\t\t\t\tundo.logAction(action);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_storeEntityCommand: function(obj, old, actionType, entityType){\r\n\t\t\tvar undo = gantt._undo;\r\n\t\t\tvar command = undo.command.create(obj, old, actionType, entityType);\r\n\t\t\tthis._storeCommand(command);\r\n\t\t},\r\n\t\t_storeTaskCommand: function(obj, type){\r\n\t\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, gantt._undo.command.entity.task);\r\n\t\t},\r\n\t\t_storeLinkCommand: function(obj, type){\r\n\t\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, gantt._undo.command.entity.link);\r\n\t\t},\r\n\t\tonTaskAdded:function(task){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.add);\r\n\t\t},\r\n\t\tonTaskUpdated:function(task){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.update);\r\n\t\t},\r\n\t\tonTaskMoved: function(task){\r\n\t\t\tif (!this._ignore) {\r\n\t\t\t\tthis._storeEntityCommand(\r\n\t\t\t\t\ttask,\r\n\t\t\t\t\tthis.getInitialTask(task.id),\r\n\t\t\t\t\tgantt._undo.command.type.move,\r\n\t\t\t\t\tgantt._undo.command.entity.task\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTaskDeleted: function(task){\r\n\t\t\tif(!this._ignore){\r\n\t\t\t\tthis._storeTaskCommand(task, gantt._undo.command.type.remove);\r\n\t\t\t\tif(this._nestedTasks[task.id]){\r\n\t\t\t\t\tvar children = this._nestedTasks[task.id];\r\n\t\t\t\t\tfor(var i = 0; i < children.length; i++){\r\n\t\t\t\t\t\tthis._storeTaskCommand(children[i], gantt._undo.command.type.remove);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(this._nestedLinks[task.id]){\r\n\t\t\t\t\tvar childrenLinks = this._nestedLinks[task.id];\r\n\t\t\t\t\tfor(var i = 0; i < childrenLinks.length; i++){\r\n\t\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], gantt._undo.command.type.remove);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonLinkAdded: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.add);\r\n\t\t},\r\n\t\tonLinkUpdated: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.update);\r\n\t\t},\r\n\t\tonLinkDeleted: function(link){\r\n\t\t\tif(!this._ignore)\r\n\t\t\t\tthis._storeLinkCommand(link, gantt._undo.command.type.remove);\r\n\t\t},\r\n\t\t_initialTasks:{},\r\n\t\t_nestedTasks:{},\r\n\t\t_nestedLinks:{},\r\n\t\t_getLinks: function(task){\r\n\t\t\treturn task.$source.concat(task.$target);\r\n\t\t},\r\n\t\tsetNestedTasks: function(id, taskIds){\r\n\t\t\tvar task = null,\r\n\t\t\t\ttasks = [],\r\n\t\t\t\tlinkIds = this._getLinks(gantt.getTask(id));\r\n\r\n\t\t\tfor(var i = 0; i < taskIds.length; i++){\r\n\t\t\t\ttask = this.setInitialTask(taskIds[i]);\r\n\r\n\t\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\r\n\r\n\r\n\t\t\t\ttasks.push(task);\r\n\t\t\t}\r\n\r\n\t\t\tvar uniqueLinks = {};\r\n\t\t\tfor(var i = 0; i < linkIds.length; i++){\r\n\t\t\t\tuniqueLinks[linkIds[i]] = true;\r\n\t\t\t}\r\n\t\t\tvar links = [];\r\n\t\t\tfor(var i in uniqueLinks){\r\n\t\t\t\tlinks.push(this.setInitialLink(i));\r\n\t\t\t}\r\n\t\t\tthis._nestedTasks[id] = tasks;\r\n\t\t\tthis._nestedLinks[id] = links;\r\n\t\t},\r\n\t\tsetInitialTask: function(id, overwrite){\r\n\t\t\tif (overwrite || (!this._initialTasks[id] || !this._batchMode)) {\r\n\t\t\t\tvar task = gantt.copy(gantt.getTask(id));\r\n\t\t\t\ttask.$index = gantt.getTaskIndex(id);\r\n\t\t\t\tthis.setInitialTaskObject(id, task);\r\n\t\t\t}\r\n\t\t\treturn this._initialTasks[id];\r\n\t\t},\r\n\t\tgetInitialTask: function(id){\r\n\t\t\treturn this._initialTasks[id];\r\n\t\t},\r\n\t\tclearInitialTasks: function(){\r\n\t\t\tthis._initialTasks = {};\r\n\t\t},\r\n\t\tsetInitialTaskObject: function(id, object) {\r\n\t\t\tthis._initialTasks[id] = object;\r\n\t\t},\r\n\r\n\t\t_initialLinks:{},\r\n\t\tsetInitialLink: function(id){\r\n\t\t\tif(!this._initialLinks[id] || !this._batchMode)\r\n\t\t\t\tthis._initialLinks[id] = gantt.copy(gantt.getLink(id));\r\n\r\n\t\t\treturn this._initialLinks[id];\r\n\t\t},\r\n\t\tgetInitialLink: function(id){\r\n\t\t\treturn this._initialLinks[id];\r\n\t\t}\r\n\t}\r\n\r\n\r\n};\r\ngantt._undo.updateConfigs = function(){\r\n\tgantt._undo.maxSteps = gantt.config.undo_steps;\r\n\tgantt._undo.command.entity = gantt.config.undo_types;\r\n\tgantt._undo.command.type = gantt.config.undo_actions;\r\n\tgantt._undo.undo_enabled = !!gantt.config.undo;\r\n\tgantt._undo.redo_enabled = (!!gantt.config.undo) && (!!gantt.config.redo);\r\n};\r\n\r\n\r\n(function(){\r\n\r\n\tvar monitor = gantt._undo.monitor;\r\n\r\n\tvar noTrack = {\r\n\t\t\"onBeforeUndo\":\"onAfterUndo\",\r\n\t\t\"onBeforeRedo\": \"onAfterRedo\"\r\n\t};\r\n\tfor(var i in noTrack){\r\n\t\tgantt.attachEvent(i, function(){\r\n\t\t\tmonitor.startIgnore();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(noTrack[i], function(){\r\n\t\t\tmonitor.stopIgnore();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tvar batchActions = [\r\n\t\t\"onTaskDragStart\",\r\n\t\t\"onAfterTaskUpdate\",\r\n\t\t\"onAfterTaskDelete\",\r\n\t\t\"onBeforeBatchUpdate\"\r\n\t];\r\n\r\n\tfor(var i  = 0; i < batchActions.length; i++){\r\n\t\tgantt.attachEvent(batchActions[i], function(){\r\n\t\t\tmonitor.startBatchAction();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\tfunction store(id){\r\n\t\tmonitor.setInitialTask(id);\r\n\t\tgantt.eachTask(function(child){\r\n\t\t\tmonitor.setInitialTask(child.id);\r\n\t\t}, id);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDrag\", store);\r\n\tgantt.attachEvent(\"onLightbox\", store);\r\n\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", function(task){ store(task.id);  return true;});\r\n\r\n\tvar deleteCacheCooldown = null;\r\n\r\n\tfunction saveInitialAll(){\r\n\t\tif(!deleteCacheCooldown){\r\n\t\t\tdeleteCacheCooldown = setTimeout(function(){\r\n\t\t\t\tdeleteCacheCooldown = null;\r\n\t\t\t});\r\n\r\n\t\t\tmonitor.clearInitialTasks();\r\n\t\t\tgantt.eachTask(function(task){\r\n\t\t\t\tmonitor.setInitialTask(task.id);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id){\r\n\t\tstore(id);\r\n\t\tvar nested = [];\r\n\r\n\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\r\n\t\tsaveInitialAll();\r\n\r\n\t\tgantt.eachTask(function(task){\r\n\t\t\tnested.push(task.id);\r\n\t\t}, id);\r\n\t\tmonitor.setNestedTasks(id, nested);\r\n\t\treturn true;\r\n\t});\r\n\tif(gantt.ext.inlineEditors){\r\n\t\tgantt.ext.inlineEditors.attachEvent(\"onEditStart\", function(state){\r\n\t\t\tstore(state.id);\r\n\t\t});\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", function (id, task) {\r\n\t\tmonitor.setInitialTask(id, true);\r\n\t\tmonitor.onTaskAdded(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterTaskUpdate\", function(id, task){\r\n\t\tmonitor.onTaskUpdated(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, task){\r\n\t\tmonitor.onTaskDeleted(task);\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onAfterLinkAdd\", function(id, task){\r\n\t\tmonitor.onLinkAdded(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterLinkUpdate\", function(id, task){\r\n\t\tmonitor.onLinkUpdated(task);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, task){\r\n\t\tmonitor.onLinkDeleted(task);\r\n\t});\r\n\r\n\tvar datastore = gantt.getDatastore(\"task\");\r\n\r\n\tdatastore.attachEvent(\"onBeforeItemMove\", function(id, parent, tindex){\r\n\t\tif (!monitor.isMoveEventsIgnored()) {\r\n\r\n\t\t\tsaveInitialAll();\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\r\n\tdatastore.attachEvent(\"onAfterItemMove\", function(id, parent, tindex){\r\n\t\tif (!monitor.isMoveEventsIgnored()) {\r\n\t\t\tmonitor.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onRowDragStart\", function(id, target, e) {\r\n\t\tmonitor.toggleIgnoreMoveEvents(true);\r\n\t\tsaveInitialAll();\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onRowDragEnd\", function(id, target) {\r\n\t\tmonitor.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\tmonitor.toggleIgnoreMoveEvents();\r\n\t\treturn true;\r\n\t});\r\n\r\n\tfunction getMoveObjectByTaskId(id) {\r\n\t\treturn gantt.copy(gantt.getTask(id));\r\n\t}\r\n\r\n\tfunction updTask(task, oldId, newId){\r\n\t\tif(!task) return;\r\n\r\n\t\tif(task.id == oldId){\r\n\t\t\ttask.id = newId;\r\n\t\t}\r\n\r\n\t\tif(task.parent == oldId){\r\n\t\t\ttask.parent = newId;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction changeTaskCommandId(command, oldId, newId){\r\n\t\tupdTask(command.value, oldId, newId);\r\n\t\tupdTask(command.oldValue, oldId, newId);\r\n\t}\r\n\r\n\tfunction updLink(link, oldTaskId, newTaskId){\r\n\t\tif(!link) return;\r\n\t\tif(link.source == oldTaskId){\r\n\t\t\tlink.source = newTaskId;\r\n\t\t}\r\n\t\tif(link.target == oldTaskId){\r\n\t\t\tlink.target = newTaskId;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction changeLinkCommandId(command, oldId, newId){\r\n\t\tupdLink(command.value, oldId, newId);\r\n\t\tupdLink(command.oldValue, oldId, newId);\r\n\t}\r\n\r\n\tfunction updateTasksIds(log, oldId, newId) {\r\n\t\tvar undo = gantt._undo;\r\n\r\n\t\tfor (var i = 0; i < log.length; i++) {\r\n\t\t\tvar entry = log[i];\r\n\t\t\tfor (var j = 0; j < entry.commands.length; j++) {\r\n\t\t\t\tif (entry.commands[j].entity == undo.command.entity.task) {\r\n\t\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t\t} else if (entry.commands[j].entity == undo.command.entity.link) {\r\n\t\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateLinksIds(log, oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\r\n\t\tfor (var i = 0; i < log.length; i++) {\r\n\t\t\tvar entry = log[i];\r\n\t\t\tfor (var j = 0; j < entry.commands.length; j++) {\r\n\t\t\t\tvar command = entry.commands[j];\r\n\t\t\t\tif (command.entity == undo.command.entity.link) {\r\n\t\t\t\t\tif(command.value && command.value.id == oldId){\r\n\t\t\t\t\t\tcommand.value.id = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(command.oldValue && command.oldValue.id == oldId){\r\n\t\t\t\t\t\tcommand.oldValue.id = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\t\tupdateTasksIds(undo._undoStack,oldId, newId);\r\n\t\tupdateTasksIds(undo._redoStack,oldId, newId);\r\n\t});\r\n\tgantt.attachEvent(\"onLinkIdChange\", function(oldId, newId){\r\n\t\tvar undo = gantt._undo;\r\n\t\tupdateLinksIds(undo._undoStack,oldId, newId);\r\n\t\tupdateLinksIds(undo._redoStack,oldId, newId);\r\n\t});\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tgantt._undo.updateConfigs();\r\n\t});\r\n})();\r\n"],"sourceRoot":""}